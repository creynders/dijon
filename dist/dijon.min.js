/*! dijon - v0.6.2 - 2014-08-01 Copyright (c) 2014 Camille Reynders (http://www.creynders.be/); Licensed MIT */(function(t,e){"object"==typeof exports?module.exports=e():"function"==typeof define&&define.amd?define(e):t.dijon=e()})(this,function(){"use strict";var t="no mapping found for this key",e={version:"0.6.2"};return e.System=function(){this._mappings={},this._outlets={},this._handlers={},this.strictInjections=!0,this.autoMapOutlets=!1,this.postInjectionHook="setup"},e.System.prototype={_createAndSetupInstance:function(t,e){var n=new e;return this.injectInto(n,t),n},_retrieveFromCacheOrCreate:function(e,n){n===void 0&&(n=!1);var s;if(!this._mappings.hasOwnProperty(e))throw t;var i=this._mappings[e];return!n&&i.isSingleton?(null===i.object&&(i.object=this._createAndSetupInstance(e,i.clazz)),s=i.object):s=i.clazz?this._createAndSetupInstance(e,i.clazz):i.object,s},mapOutlet:function(t,e,n){return e=e||"global",n=n||t,this._outlets.hasOwnProperty(e)||(this._outlets[e]={}),this._outlets[e][n]=t,this},getObject:function(t){return this._retrieveFromCacheOrCreate(t)},mapValue:function(t,e){return this._mappings[t]={clazz:null,object:e,isSingleton:!0},this.autoMapOutlets&&this.mapOutlet(t),this.hasMapping(t)&&this.injectInto(e,t),this},hasMapping:function(t){return this._mappings.hasOwnProperty(t)},mapClass:function(t,e){return this._mappings[t]={clazz:e,object:null,isSingleton:!1},this.autoMapOutlets&&this.mapOutlet(t),this},mapSingleton:function(t,e){return this._mappings[t]={clazz:e,object:null,isSingleton:!0},this.autoMapOutlets&&this.mapOutlet(t),this},instantiate:function(t){return this._retrieveFromCacheOrCreate(t,!0)},injectInto:function(t,e){if("object"==typeof t){var n=[];this._outlets.hasOwnProperty("global")&&n.push(this._outlets.global),e!==void 0&&this._outlets.hasOwnProperty(e)&&n.push(this._outlets[e]);for(var s in n){var i=n[s];for(var r in i){var a=i[r];(!this.strictInjections||r in t)&&(t[r]=this.getObject(a))}}this.postInjectionHook in t&&t[this.postInjectionHook].call(t)}return this},unmap:function(t){return delete this._mappings[t],this},unmapOutlet:function(t,e){return delete this._outlets[t][e],this},mapHandler:function(t,e,n,s,i){return e=e||"global",n=n||t,s===void 0&&(s=!1),i===void 0&&(i=!1),this._handlers.hasOwnProperty(t)||(this._handlers[t]={}),this._handlers[t].hasOwnProperty(e)||(this._handlers[t][e]=[]),this._handlers[t][e].push({handler:n,oneShot:s,passEvent:i}),this},unmapHandler:function(t,e,n){if(e=e||"global",n=n||t,this._handlers.hasOwnProperty(t)&&this._handlers[t].hasOwnProperty(e)){var s=this._handlers[t][e];for(var i in s){var r=s[i];if(r.handler===n){s.splice(i,1);break}}}return this},notify:function(t){var e=Array.prototype.slice.call(arguments),n=e.slice(1);if(this._handlers.hasOwnProperty(t)){var s=this._handlers[t];for(var i in s){var r,a=s[i];"global"!==i&&(r=this.getObject(i));var o,h,l=[];for(o=0,h=a.length;h>o;o++){var u,p=a[o];u=r&&"string"==typeof p.handler?r[p.handler]:p.handler,p.oneShot&&l.unshift(o),p.passEvent?u.apply(r,e):u.apply(r,n)}for(o=0,h=l.length;h>o;o++)a.splice(l[o],1)}}return this}},e});